<style>
table { width:100%; }
#datatable caption { text-align:left;  }
#datatable thead th { text-align:left; border-bottom-width:1px; border-top-width:1px; }
#datatable th, td { text-align:left; padding:6px;} 
</style>
<script>
$(document).ready(function() {
    //alert("dataTable");
    $('#datatable').dataTable( {
        "bPaginate": false,
        "bLengthChange": false,
        "bFilter": false,
        "bSort": true,
        "bInfo": false,
        "bAutoWidth": false,
        "bRetrieve": true, /* to fix warning: "Cannot reinitialise DataTable." */
    } );
} );

function addfunc()
{
    //alert("addfunc");
    var url="/worker/manage/add";
    redirect(url);
}

function editfunc()
{
    var elmNo = 0; 
    var chkCount=0;
    var form = document.dataform;
    for (var i = 0; i < form.elements.length; i++) { 
        var element = form.elements[i];   
        if(element.type == 'checkbox' && element.id != 'toggleall' && element.checked)
        {
            chkCount++; 
            elmNo = i;    
        }    
    }
    
    if(chkCount != 1)
    {
        alert("Choose one to edit!");
        return;
    }   

    var url = "/material/manage/edit?id=" + $(form.elements[elmNo]).val();
    //alert(url);
    redirect(url);
}

function deletefunc()
{
    var r=confirm("Confirm to delete?");
    if (r==false) { return false; }          

    var formname = "dataform";

    var action = "/material/manage/delete";     
    var method = "post";

    var frm = $('#dataform');    
    var toServer = {};
    $('#datatable tbody tr td input').each(function(key, value) {
        toServer[$(this).val()] = $(this).is(':checked');
    });
    
    frm.submit(function () {
        $.ajax({
            type: method,
            url: action,
            data: toServer,
            success: function (data) {
                //alert(data);
                window.location.reload();
            }
        });

        return false;
    });
    
    frm.submit();
}

function redirect(url) {
    window.location = url;
}

function checkall()
{
    //alert("checkall");
    var checked = false;
    var form = document.dataform;
    
    for (var i = 0; i < form.elements.length; i++) {
        if(form.elements[i].id == 'toggleall')
        {
            checked = form.elements[i].checked;
            break;    
        }    
    }

    for (var i = 0; i < form.elements.length; i++) {    
        if(form.elements[i].type == 'checkbox'){
                form.elements[i].checked = checked;
            }    
    }
}
</script>

<!--
<fieldset class="ui-grid-b">
	<div class="ui-block-a"><button onclick="addfunc()" data-theme="a"><?php echo $this->translate("Add Worker");?></button></div>
	<div class="ui-block-b"><button onclick="editfunc()" data-theme="a">Edit Worker</button></div>	 
	<div class="ui-block-c"><button onclick="deletefunc()" data-theme="a">Delete Worker</button></div>  
</fieldset>
-->
<a href="/worker/manage/add"><button onclick="addfunc()" data-theme="a"><?php echo $this->translate("Add Worker");?></button></a>
<form name="dataform" id="dataform">
<table id="datatable" border="3">
<thead><tr>
<!--<th><input type="checkbox" name="toggleall" id="toggleall" onClick="checkall()" data-role="none"></th>-->
<th>序号</th>
<th>服务公司</th>
<th>所在工地</th>
<th>姓名</th>
<th>中文名</th>
<th>准证号码</th>
<th>工种</th>
<th>等级</th>
<th>小时单价</th>
</tr></thead>
<tbody> 
<?php
foreach($this->result as $tmp)
{
/*
    // worker
    $id = $tmp->getId();
    $namechs = $tmp->getNamechs();
    $nameeng = $tmp->getNameeng();
    $fin = $tmp->getFin();

    // skills
    $worktype = "todo";
    $level = "todo";
    // company
    $company = "todo";
    $site = "todo";
    $hrwage = "todo";
*/
    // worker
    $id = $tmp[0]['id'];
    $namechs = $tmp[0]['namechs'];
    $nameeng = $tmp[0]['nameeng'];;
    $fin = $tmp[0]['fin'];;

    // skills
    $worktype = $tmp["worktype"];//"todo";
    $level = $tmp["worklevel"];//"todo";
    // company
    //$company = $tmp["companylabel"];
    $company = $tmp["companyname"];
    $site = $tmp["sitename"];//"todo";
    $hrwage = $tmp["hwage"];//"todo";

    $row = "<tr>";
    $row .= '<td><a data-role="button"  data-mini="true" href="/worker/manage/edit?id=' . $id . '">' . $id . '</a></td>' ;
    $row .= "<td>$company</td>" ;
    $row .= "<td>$site</td>" ;
    $row .= "<td>$nameeng</td>" ;
    $row .= "<td>$namechs</td>" ;
    $row .= "<td>$fin</td>" ;
    $row .= "<td>$worktype</td>" ;
    $row .= "<td>$level</td>" ;
    $row .= "<td>$hrwage</td>" ;
    $row .= "</tr>";
    echo $row;
}
?>
</tbody> 
</table>
</form><!-- dataform -->
